document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("refreshBtn"),t=document.getElementById("refreshBtnMobile"),s=document.getElementById("toggleAutoRefresh"),n=document.getElementById("toggleAutoRefreshMobile"),o=document.getElementById("showPhpInfoBtn"),a=new bootstrap.Modal(document.getElementById("phpInfoModal")),d=document.getElementById("phpInfoFrame"),i=document.getElementById("lastUpdated"),r=document.getElementById("autoRefreshText");let c=!1,l=null;function u(e){e&&e.addEventListener("click",(function(){f()}))}function m(e,t=!1){e&&e.addEventListener("click",(function(){c=!c,c?(l=setInterval(f,3e4),!t&&s&&(s.classList.remove("btn-outline-secondary"),s.classList.add("btn-success"),r&&(r.textContent=b("system_info.auto_refresh_enabled"))),t&&(e.classList.remove("btn-outline-secondary"),e.classList.add("btn-success")),h(b("system_info.auto_refresh")+" "+b("system_info.auto_refresh_enabled"),"success")):(l&&(clearInterval(l),l=null),!t&&s&&(s.classList.remove("btn-success"),s.classList.add("btn-outline-secondary"),r&&(r.textContent=b("system_info.auto_refresh"))),t&&(e.classList.remove("btn-success"),e.classList.add("btn-outline-secondary")),h(b("system_info.auto_refresh")+" "+b("system_info.auto_refresh_disabled"),"info"))}))}function f(){[e,t].filter((e=>e)).forEach((e=>{e.disabled=!0;const t=e.innerHTML;e.innerHTML='<span class="spinner-border spinner-border-sm"></span>',e.dataset.originalHtml=t})),fetch("/admin/system-info/json",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then((e=>e.json())).then((e=>{e.success?(!function(e){document.querySelectorAll("[data-field]").forEach((t=>{const s=t.getAttribute("data-field"),n=(o=e,s.split(".").reduce(((e,t)=>e?.[t]),o));var o;null!=n&&(t.textContent=n)}));const t=document.getElementById("diskProgressBar");if(t&&e.disk){const s=parseFloat(e.disk.usage_percent);t.style.width=s+"%",t.setAttribute("aria-valuenow",s),t.className="progress-bar",s>90?t.classList.add("bg-danger"):s>75?t.classList.add("bg-warning"):t.classList.add("bg-success")}const s=document.getElementById("envBadge");s&&e.app&&(s.className="badge",s.classList.add("production"===e.app.environment?"bg-success":"bg-warning"))}(e.data),i.textContent=b("system_info.last_updated")+": "+e.timestamp,c||h("System information updated","success")):h("Error updating system info","danger")})).catch((e=>{h("Failed to update system info","danger")})).finally((()=>{e&&(e.disabled=!1,e.innerHTML='<i class="bi bi-arrow-clockwise"></i> '+b("system_info.refresh")),t&&(t.disabled=!1,t.innerHTML='<i class="bi bi-arrow-clockwise"></i>')}))}function b(e){return{"system_info.auto_refresh":"Auto-Refresh","system_info.auto_refresh_enabled":"Enabled (30s)","system_info.auto_refresh_disabled":"Disabled","system_info.refresh":"Refresh","system_info.last_updated":"Last Updated"}[e]||e}function h(e,t="info"){const s=`\n            <div class="toast align-items-center text-white bg-${t} border-0" role="alert">\n                <div class="d-flex">\n                    <div class="toast-body">${e}</div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>\n                </div>\n            </div>\n        `;let n=document.getElementById("toastContainer");n||(n=document.createElement("div"),n.id="toastContainer",n.className="toast-container position-fixed top-0 end-0 p-3",document.body.appendChild(n)),n.insertAdjacentHTML("beforeend",s);const o=n.lastElementChild;new bootstrap.Toast(o,{delay:3e3}).show(),o.addEventListener("hidden.bs.toast",(function(){o.remove()}))}u(e),u(t),m(s,!1),m(n,!0),o&&o.addEventListener("click",(function(){a.show(),d.src="/admin/phpinfo"}))}));