!function(){"use strict";const t=1e4,e={status:"/admin/mail-scheduler/status",start:"/admin/mail-scheduler/start",stop:"/admin/mail-scheduler/stop",jobs:"/admin/mail-scheduler/jobs",deleteJob:"/admin/mail-scheduler/jobs/delete"};let n=1,s=6,a="",d=null,o=null;function r(){u(!0);const t=new URLSearchParams({page:n,pageSize:s,status:a});fetch(`${e.jobs}?${t}`).then((t=>t.json())).then((t=>{t.success?(!function(t){const e=document.getElementById("jobTableBody"),n=document.getElementById("jobCardsBody");if(!t||0===t.length)return e.innerHTML='<tr><td colspan="8" class="text-center">No jobs found</td></tr>',void(n.innerHTML='<p class="text-center">No jobs found</p>');e.innerHTML=t.map((t=>`\n            <tr>\n                <td>${t.id}</td>\n                <td><span class="badge bg-${p(t.status)}">${t.status}</span></td>\n                <td>${g(t.recipient)}</td>\n                <td>${g(t.subject)}</td>\n                <td>${g(t.template)}</td>\n                <td>${t.attempts} / ${t.max_attempts}</td>\n                <td>${m(t.scheduled_at)}</td>\n                <td>\n                    <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                        <i class="bi-eye"></i>\n                    </button>\n                    ${"pending"===t.status||"failed"===t.status?`\n                        <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                            <i class="bi-trash"></i>\n                        </button>\n                    `:""}\n                </td>\n            </tr>\n        `)).join(""),n.innerHTML=t.map((t=>`\n            <div class="card mb-3">\n                <div class="card-header d-flex justify-content-between">\n                    <span><strong>#${t.id}</strong></span>\n                    <span class="badge bg-${p(t.status)}">${t.status}</span>\n                </div>\n                <div class="card-body">\n                    <p class="card-text">\n                        <strong>Recipient:</strong> ${g(t.recipient)}<br>\n                        <strong>Subject:</strong> ${g(t.subject)}<br>\n                        <strong>Template:</strong> ${g(t.template)}<br>\n                        <strong>Attempts:</strong> ${t.attempts} / ${t.max_attempts}<br>\n                        <strong>Scheduled:</strong> ${m(t.scheduled_at)}\n                    </p>\n                    <div class="d-flex gap-2">\n                        <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                            <i class="bi-eye"></i> Details\n                        </button>\n                        ${"pending"===t.status||"failed"===t.status?`\n                            <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                                <i class="bi-trash"></i> Delete\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `)).join("")}(t.jobs),function(t){const e=document.getElementById("paginationInfo"),s=document.getElementById("pagination");e.textContent=`${h("page")} ${t.page} ${h("of")} ${t.totalPages}`;let a="";t.page>1&&(a+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page-1}">Previous</a></li>`);t.page<t.totalPages&&(a+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page+1}">Next</a></li>`);s.innerHTML=a,s.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),n=parseInt(this.dataset.page),r()}))}))}(t.pagination),c(t.stats)):window.showToast(h("load-error"),"error","Error")})).catch((t=>{window.showToast(h("load-error"),"error","Error")})).finally((()=>{u(!1)}))}function c(t){t&&(document.getElementById("statPending").textContent=t.pending||0,document.getElementById("statProcessing").textContent=t.processing||0,document.getElementById("statCompleted").textContent=t.completed||0,document.getElementById("statFailed").textContent=t.failed||0)}function i(t){const e=t?'Status:&nbsp;<span class="p-2"><span class="bi-check-circle-fill text-success">&nbsp;Running</span></span>':'Status:&nbsp;<span class="p-2"><span class="bi-x-circle-fill text-danger">&nbsp;Stopped</span></span>';document.getElementById("statusIndicator").innerHTML=e;const n=t?'<button type="button" class="btn btn-danger" data-action="stop-scheduler"><span class="bi-stop-circle"></span>&nbsp;Stop Scheduler</button>':'<button type="button" class="btn btn-success" data-action="start-scheduler"><span class="bi-play-circle"></span>&nbsp;Start Scheduler</button>';document.getElementById("schedulerButtonContainer").innerHTML=n}function l(t){const e=document.getElementById("schedulerButtonContainer"),n=document.getElementById("schedulerLoadingSpinner");t?(e.classList.add("d-none"),n.classList.remove("d-none")):(e.classList.remove("d-none"),n.classList.add("d-none"))}function u(t){const e=document.getElementById("loadingSpinner");e&&e.classList.toggle("d-none",!t)}function p(t){return{pending:"warning",processing:"info",completed:"success",failed:"danger"}[t]||"secondary"}function m(t){return t?new Date(t).toLocaleString():"N/A"}function g(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function h(t){return document.getElementById("scheduler-messages")?.dataset[t]||t}document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",(function(t){const d=t.target.closest("[data-action]")?.dataset.action;switch(d){case"start-scheduler":!function(){l(!0);const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.start,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(h("scheduler-started"),"success","Scheduler"),i(!0)):window.showToast(t.message||h("scheduler-error"),"error","Error")})).catch((t=>{window.showToast(h("scheduler-error"),"error","Error")})).finally((()=>{l(!1)}))}();break;case"stop-scheduler":!function(){l(!0);const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.stop,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(h("scheduler-stopped"),"success","Scheduler"),i(!1)):window.showToast(t.message||h("scheduler-error"),"error","Error")})).catch((t=>{window.showToast(h("scheduler-error"),"error","Error")})).finally((()=>{l(!1)}))}();break;case"change-page-size":handlePageSizeChange(t.target);break;case"filter-status":handleStatusFilter(t.target);break;case"delete-job":c=t.target.closest("[data-job-id]").dataset.jobId,o=c,new bootstrap.Modal(document.getElementById("confirmDeleteModal")).show();break;case"show-details":!function(t){if(!t)return;const d=new URLSearchParams({page:n,pageSize:s,status:a});fetch(`${e.jobs}?${d}`).then((t=>t.json())).then((e=>{if(e.success){const n=e.jobs.find((e=>e.id==t));n&&(!function(t){const e=document.getElementById("jobDetailsContent");if(!e)return;let n="N/A";try{const e=JSON.parse(t.template_data);n=`<pre>${JSON.stringify(e,null,2)}</pre>`}catch(e){n=g(t.template_data)}e.innerHTML=`\n            <div class="row">\n                <div class="col-md-6">\n                    <dl>\n                        <dt>Job ID</dt>\n                        <dd>#${t.id}</dd>\n                        \n                        <dt>Status</dt>\n                        <dd><span class="badge bg-${p(t.status)}">${t.status}</span></dd>\n                        \n                        <dt>Recipient</dt>\n                        <dd>${g(t.recipient)}</dd>\n                        \n                        <dt>Subject</dt>\n                        <dd>${g(t.subject)}</dd>\n                        \n                        <dt>Template</dt>\n                        <dd><code>${g(t.template)}</code></dd>\n                    </dl>\n                </div>\n                <div class="col-md-6">\n                    <dl>\n                        <dt>Attempts</dt>\n                        <dd>${t.attempts} / ${t.max_attempts}</dd>\n                        \n                        <dt>Created</dt>\n                        <dd>${m(t.created_at)}</dd>\n                        \n                        <dt>Scheduled</dt>\n                        <dd>${m(t.scheduled_at)}</dd>\n                        \n                        <dt>Started</dt>\n                        <dd>${m(t.started_at)}</dd>\n                        \n                        <dt>Completed</dt>\n                        <dd>${m(t.completed_at)}</dd>\n                    </dl>\n                </div>\n            </div>\n            \n            ${t.last_error?`\n                <div class="alert alert-danger mt-3">\n                    <strong>Last Error:</strong><br>\n                    ${g(t.last_error)}\n                </div>\n            `:""}\n            \n            <div class="mt-3">\n                <strong>Template Data:</strong>\n                ${n}\n            </div>\n        `}(n),new bootstrap.Modal(document.getElementById("detailsModal")).show())}})).catch((t=>{window.showToast("Error loading job details","error","Error")}))}(t.target.closest("[data-job-id]").dataset.jobId);break;case"confirm-delete":!function(){if(!o)return;const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.deleteJob,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(h("job-deleted"),"success","Job Deleted"),r(),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide()):(window.showToast(t.message||h("delete-error"),"error","Error"),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide())})).catch((t=>{window.showToast(h("delete-error"),"error","Error"),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide()})).finally((()=>{o=null}))}();break}var c})),document.getElementById("pageSize")?.addEventListener("change",(function(){s=parseInt(this.value),n=1,r()})),document.getElementById("statusFilter")?.addEventListener("change",(function(){a=this.value,n=1,r()})),r(),d=setInterval((()=>{fetch(e.status).then((t=>t.json())).then((t=>{t.success&&(i(t.status.running),document.getElementById("lastTick").textContent=t.status.lastTick||"Never",c(t.stats))})).catch((t=>{})),r()}),t)})),window.addEventListener("beforeunload",(function(){d&&clearInterval(d)}))}();