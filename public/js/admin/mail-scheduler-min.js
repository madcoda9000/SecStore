!function(){"use strict";const t=1e4,e={status:"/admin/mail-scheduler/status",start:"/admin/mail-scheduler/start",stop:"/admin/mail-scheduler/stop",jobs:"/admin/mail-scheduler/jobs",deleteJob:"/admin/mail-scheduler/jobs/delete"};let n=1,s=20,a="",d=null,o=null;function c(){l(!0);const t=new URLSearchParams({page:n,pageSize:s,status:a});fetch(`${e.jobs}?${t}`).then((t=>t.json())).then((t=>{t.success?(!function(t){const e=document.getElementById("jobTableBody"),n=document.getElementById("jobCardsBody");if(!t||0===t.length)return e.innerHTML='<tr><td colspan="8" class="text-center">No jobs found</td></tr>',void(n.innerHTML='<p class="text-center">No jobs found</p>');e.innerHTML=t.map((t=>`\n            <tr>\n                <td>${t.id}</td>\n                <td><span class="badge bg-${u(t.status)}">${t.status}</span></td>\n                <td>${b(t.recipient)}</td>\n                <td>${b(t.subject)}</td>\n                <td>${b(t.template)}</td>\n                <td>${t.attempts} / ${t.max_attempts}</td>\n                <td>${g(t.scheduled_at)}</td>\n                <td>\n                    <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                        <i class="bi-eye"></i>\n                    </button>\n                    ${"pending"===t.status||"failed"===t.status?`\n                        <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                            <i class="bi-trash"></i>\n                        </button>\n                    `:""}\n                </td>\n            </tr>\n        `)).join(""),n.innerHTML=t.map((t=>`\n            <div class="card mb-3">\n                <div class="card-header d-flex justify-content-between">\n                    <span><strong>#${t.id}</strong></span>\n                    <span class="badge bg-${u(t.status)}">${t.status}</span>\n                </div>\n                <div class="card-body">\n                    <p class="card-text">\n                        <strong>Recipient:</strong> ${b(t.recipient)}<br>\n                        <strong>Subject:</strong> ${b(t.subject)}<br>\n                        <strong>Template:</strong> ${b(t.template)}<br>\n                        <strong>Attempts:</strong> ${t.attempts} / ${t.max_attempts}<br>\n                        <strong>Scheduled:</strong> ${g(t.scheduled_at)}\n                    </p>\n                    <div class="d-flex gap-2">\n                        <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                            <i class="bi-eye"></i> Details\n                        </button>\n                        ${"pending"===t.status||"failed"===t.status?`\n                            <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                                <i class="bi-trash"></i> Delete\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `)).join("")}(t.jobs),function(t){const e=document.getElementById("paginationInfo"),s=document.getElementById("pagination");e.textContent=`${p("page")} ${t.page} ${p("of")} ${t.totalPages}`;let a="";t.page>1&&(a+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page-1}">Previous</a></li>`);t.page<t.totalPages&&(a+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page+1}">Next</a></li>`);s.innerHTML=a,s.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),n=parseInt(this.dataset.page),c()}))}))}(t.pagination),i(t.stats)):m("danger",p("load-error"))})).catch((t=>{m("danger",p("load-error"))})).finally((()=>{l(!1)}))}function i(t){t&&(document.getElementById("statPending").textContent=t.pending||0,document.getElementById("statProcessing").textContent=t.processing||0,document.getElementById("statCompleted").textContent=t.completed||0,document.getElementById("statFailed").textContent=t.failed||0)}function r(t){const e=document.getElementById("statusIndicator"),n=t?'<span class="badge bg-success fs-5"><span class="bi-check-circle-fill"></span>&nbsp;Running</span>':'<span class="badge bg-danger fs-5"><span class="bi-x-circle-fill"></span>&nbsp;Stopped</span>';e.innerHTML=n;const s=t?'<button type="button" class="btn btn-danger" data-action="stop-scheduler"><span class="bi-stop-circle"></span>&nbsp;Stop Scheduler</button>':'<button type="button" class="btn btn-success" data-action="start-scheduler"><span class="bi-play-circle"></span>&nbsp;Start Scheduler</button>';e.nextElementSibling.innerHTML=s}function l(t){const e=document.getElementById("loadingSpinner");e&&e.classList.toggle("d-none",!t)}function u(t){return{pending:"warning",processing:"info",completed:"success",failed:"danger"}[t]||"secondary"}function g(t){return t?new Date(t).toLocaleString():"N/A"}function b(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function p(t){return document.getElementById("scheduler-messages")?.dataset[t]||t}function m(t,e){const n=document.querySelector(".container"),s=document.createElement("div");s.className=`alert alert-${t} alert-dismissible fade show`,s.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,n.insertBefore(s,n.firstChild),setTimeout((()=>s.remove()),5e3)}document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",(function(t){const n=t.target.closest("[data-action]")?.dataset.action;switch(n){case"start-scheduler":fetch(e.start,{method:"POST",headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{t.success?(m("success",p("scheduler-started")),r(!0)):m("danger",t.message||p("scheduler-error"))})).catch((t=>{m("danger",p("scheduler-error"))}));break;case"stop-scheduler":fetch(e.stop,{method:"POST",headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{t.success?(m("success",p("scheduler-stopped")),r(!1)):m("danger",t.message||p("scheduler-error"))})).catch((t=>{m("danger",p("scheduler-error"))}));break;case"change-page-size":handlePageSizeChange(t.target);break;case"filter-status":handleStatusFilter(t.target);break;case"delete-job":s=t.target.closest("[data-job-id]").dataset.jobId,o=s,new bootstrap.Modal(document.getElementById("confirmDeleteModal")).show();break;case"show-details":showJobDetails(t.target.closest("[data-job-id]").dataset.jobId);break;case"confirm-delete":o&&fetch(e.deleteJob,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o})}).then((t=>t.json())).then((t=>{t.success?(m("success",p("job-deleted")),c(),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide()):m("danger",t.message||p("delete-error"))})).catch((t=>{m("danger",p("delete-error"))})).finally((()=>{o=null}));break}var s})),document.getElementById("pageSize")?.addEventListener("change",(function(){s=parseInt(this.value),n=1,c()})),document.getElementById("statusFilter")?.addEventListener("change",(function(){a=this.value,n=1,c()})),c(),d=setInterval((()=>{fetch(e.status).then((t=>t.json())).then((t=>{t.success&&(r(t.status.running),document.getElementById("lastTick").textContent=t.status.lastTick||"Never",i(t.stats))})).catch((t=>{}))}),t)})),window.addEventListener("beforeunload",(function(){d&&clearInterval(d)}))}();