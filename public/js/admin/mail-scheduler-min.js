!function(){"use strict";const t=1e4,e={status:"/admin/mail-scheduler/status",start:"/admin/mail-scheduler/start",stop:"/admin/mail-scheduler/stop",jobs:"/admin/mail-scheduler/jobs",deleteJob:"/admin/mail-scheduler/jobs/delete"};let n=1,a=6,s="",d=null,o=null;function r(){u(!0);const t=new URLSearchParams({page:n,pageSize:a,status:s});fetch(`${e.jobs}?${t}`).then((t=>t.json())).then((t=>{t.success?(!function(t){const e=document.getElementById("jobTableBody"),n=document.getElementById("jobCardsBody");if(!t||0===t.length)return e.innerHTML='<tr><td colspan="8" class="text-center">No jobs found</td></tr>',void(n.innerHTML='<p class="text-center">No jobs found</p>');e.innerHTML=t.map((t=>`\n            <tr>\n                <td>${t.id}</td>\n                <td><span class="badge bg-${h(t.status)}">${t.status}</span></td>\n                <td>${p(t.recipient)}</td>\n                <td>${p(t.subject)}</td>\n                <td>${p(t.template)}</td>\n                <td>${t.attempts} / ${t.max_attempts}</td>\n                <td>${g(t.scheduled_at)}</td>\n                <td>\n                    <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                          <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>\n                          <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>\n                        </svg>\n                    </button>\n                    ${"pending"===t.status||"failed"===t.status?`\n                        <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>\n                              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>\n                            </svg>\n                        </button>\n                    `:""}\n                </td>\n            </tr>\n        `)).join(""),n.innerHTML=t.map((t=>`\n            <div class="card mb-3">\n                <div class="card-header d-flex justify-content-between">\n                    <span><strong>#${t.id}</strong></span>\n                    <span class="badge bg-${h(t.status)}">${t.status}</span>\n                </div>\n                <div class="card-body">\n                    <p class="card-text">\n                        <strong>Recipient:</strong> ${p(t.recipient)}<br>\n                        <strong>Subject:</strong> ${p(t.subject)}<br>\n                        <strong>Template:</strong> ${p(t.template)}<br>\n                        <strong>Attempts:</strong> ${t.attempts} / ${t.max_attempts}<br>\n                        <strong>Scheduled:</strong> ${g(t.scheduled_at)}\n                    </p>\n                    <div class="d-flex gap-2">\n                        <button class="btn btn-sm btn-info" data-action="show-details" data-job-id="${t.id}">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                          <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>\n                          <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>\n                        </svg> Details\n                        </button>\n                        ${"pending"===t.status||"failed"===t.status?`\n                            <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                                <button class="btn btn-sm btn-danger" data-action="delete-job" data-job-id="${t.id}">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>\n                              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>\n                            </svg>â€š Delete\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `)).join("")}(t.jobs),function(t){const e=document.getElementById("paginationInfo"),a=document.getElementById("pagination");e.textContent=`${m("page")} ${t.page} ${m("of")} ${t.totalPages}`;let s="";t.page>1&&(s+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page-1}">Previous</a></li>`);t.page<t.totalPages&&(s+=`<li class="page-item"><a class="page-link" href="#" data-page="${t.page+1}">Next</a></li>`);a.innerHTML=s,a.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),n=parseInt(this.dataset.page),r()}))}))}(t.pagination),c(t.stats)):window.showToast(m("load-error"),"error","Error")})).catch((t=>{window.showToast(m("load-error"),"error","Error")})).finally((()=>{u(!1)}))}function c(t){t&&(document.getElementById("statPending").textContent=t.pending||0,document.getElementById("statProcessing").textContent=t.processing||0,document.getElementById("statCompleted").textContent=t.completed||0,document.getElementById("statFailed").textContent=t.failed||0)}function l(t){const e=t?'Status:&nbsp;<span class="p-2"><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>&nbsp;Running</span></span>':'Status:&nbsp;<span class="p-2"><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-x-circle-fill text-danger" viewBox="0 0 16 16"> <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"/></svg>&nbsp;Stopped</span></span>';document.getElementById("statusIndicator").innerHTML=e;const n=t?'<button type="button" class="btn btn-danger" data-action="stop-scheduler"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-stop-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5z"/></svg>&nbsp;Stop Scheduler</button>':'<button type="button" class="btn btn-success" data-action="start-scheduler"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-play-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445"/></svg>&nbsp;Start Scheduler</button>';document.getElementById("schedulerButtonContainer").innerHTML=n}function i(t){const e=document.getElementById("schedulerButtonContainer"),n=document.getElementById("schedulerLoadingSpinner");t?(e.classList.add("d-none"),n.classList.remove("d-none")):(e.classList.remove("d-none"),n.classList.add("d-none"))}function u(t){const e=document.getElementById("loadingSpinner");e&&e.classList.toggle("d-none",!t)}function h(t){return{pending:"warning",processing:"info",completed:"success",failed:"danger"}[t]||"secondary"}function g(t){return t?new Date(t).toLocaleString():"N/A"}function p(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function m(t){return document.getElementById("scheduler-messages")?.dataset[t]||t}document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",(function(t){const d=t.target.closest("[data-action]")?.dataset.action;switch(d){case"start-scheduler":!function(){i(!0);const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.start,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(m("scheduler-started"),"success","Scheduler"),l(!0)):window.showToast(t.message||m("scheduler-error"),"error","Error")})).catch((t=>{window.showToast(m("scheduler-error"),"error","Error")})).finally((()=>{i(!1)}))}();break;case"stop-scheduler":!function(){i(!0);const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.stop,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(m("scheduler-stopped"),"success","Scheduler"),l(!1)):window.showToast(t.message||m("scheduler-error"),"error","Error")})).catch((t=>{window.showToast(m("scheduler-error"),"error","Error")})).finally((()=>{i(!1)}))}();break;case"change-page-size":handlePageSizeChange(t.target);break;case"filter-status":handleStatusFilter(t.target);break;case"delete-job":c=t.target.closest("[data-job-id]").dataset.jobId,o=c,new bootstrap.Modal(document.getElementById("confirmDeleteModal")).show();break;case"show-details":!function(t){if(!t)return;const d=new URLSearchParams({page:n,pageSize:a,status:s});fetch(`${e.jobs}?${d}`).then((t=>t.json())).then((e=>{if(e.success){const n=e.jobs.find((e=>e.id==t));n&&(!function(t){const e=document.getElementById("jobDetailsContent");if(!e)return;let n="N/A";try{const e=JSON.parse(t.template_data);n=`<pre>${JSON.stringify(e,null,2)}</pre>`}catch(e){n=p(t.template_data)}e.innerHTML=`\n            <div class="row">\n                <div class="col-md-6">\n                    <dl>\n                        <dt>Job ID</dt>\n                        <dd>#${t.id}</dd>\n                        \n                        <dt>Status</dt>\n                        <dd><span class="badge bg-${h(t.status)}">${t.status}</span></dd>\n                        \n                        <dt>Recipient</dt>\n                        <dd>${p(t.recipient)}</dd>\n                        \n                        <dt>Subject</dt>\n                        <dd>${p(t.subject)}</dd>\n                        \n                        <dt>Template</dt>\n                        <dd><code>${p(t.template)}</code></dd>\n                    </dl>\n                </div>\n                <div class="col-md-6">\n                    <dl>\n                        <dt>Attempts</dt>\n                        <dd>${t.attempts} / ${t.max_attempts}</dd>\n                        \n                        <dt>Created</dt>\n                        <dd>${g(t.created_at)}</dd>\n                        \n                        <dt>Scheduled</dt>\n                        <dd>${g(t.scheduled_at)}</dd>\n                        \n                        <dt>Started</dt>\n                        <dd>${g(t.started_at)}</dd>\n                        \n                        <dt>Completed</dt>\n                        <dd>${g(t.completed_at)}</dd>\n                    </dl>\n                </div>\n            </div>\n            \n            ${t.last_error?`\n                <div class="alert alert-danger mt-3">\n                    <strong>Last Error:</strong><br>\n                    ${p(t.last_error)}\n                </div>\n            `:""}\n            \n            <div class="mt-3">\n                <strong>Template Data:</strong>\n                ${n}\n            </div>\n        `}(n),new bootstrap.Modal(document.getElementById("detailsModal")).show())}})).catch((t=>{window.showToast("Error loading job details","error","Error")}))}(t.target.closest("[data-job-id]").dataset.jobId);break;case"confirm-delete":!function(){if(!o)return;const t=document.getElementById("csrf_token")?.value;if(!t)throw new Error("CSRF token not found");fetch(e.deleteJob,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,csrf_token:t})}).then((t=>t.json())).then((t=>{t.success?(window.showToast(m("job-deleted"),"success","Job Deleted"),r(),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide()):(window.showToast(t.message||m("delete-error"),"error","Error"),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide())})).catch((t=>{window.showToast(m("delete-error"),"error","Error"),bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal")).hide()})).finally((()=>{o=null}))}();break}var c})),document.getElementById("pageSize")?.addEventListener("change",(function(){a=parseInt(this.value),n=1,r()})),document.getElementById("statusFilter")?.addEventListener("change",(function(){s=this.value,n=1,r()})),r(),d=setInterval((()=>{fetch(e.status).then((t=>t.json())).then((t=>{t.success&&(l(t.status.running),document.getElementById("lastTick").textContent=t.status.lastTick||"Never",c(t.stats))})).catch((t=>{})),r()}),t)})),window.addEventListener("beforeunload",(function(){d&&clearInterval(d)}))}();