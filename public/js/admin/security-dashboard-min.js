document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("security-dashboard-config");let t={refreshUrl:"/admin/security/metrics",refreshInterval:3e5};function n(){fetch(t.refreshUrl).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{location.reload()})).catch((e=>{!function(e){const t=document.createElement("div");t.className="alert alert-danger alert-dismissible fade show position-fixed",t.style.cssText="\n            top: 20px;\n            right: 20px;\n            z-index: 9999;\n            min-width: 300px;\n        ",t.innerHTML=`\n            <strong>Error:</strong> ${e}\n            <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentElement&&t.remove()}),5e3)}("Failed to refresh security metrics. Please try again.")}))}e&&(t.refreshUrl=e.getAttribute("data-refresh-url")||t.refreshUrl,t.refreshInterval=parseInt(e.getAttribute("data-refresh-interval"))||t.refreshInterval);const r=document.getElementById("refreshMetricsBtn");let s;function o(){s&&clearInterval(s),s=setInterval((()=>{n()}),t.refreshInterval)}function a(){try{const e=(new Date).toLocaleTimeString(),t=document.querySelector("h1");if(t){const n=t.querySelector(".dashboard-timestamp");n&&n.remove();const r=document.createElement("small");r.className="text-muted ms-2 dashboard-timestamp",r.textContent="(Updated: "+e+")",t.appendChild(r)}}catch(e){}}r&&r.addEventListener("click",(function(e){e.preventDefault();const t=r.innerHTML;r.innerHTML='<i class="bi bi-arrow-clockwise"></i> Refreshing...',r.disabled=!0,n(),setTimeout((()=>{r.innerHTML=t,r.disabled=!1}),3e3)})),o(),a(),window.addEventListener("beforeunload",(function(){s&&clearInterval(s)})),window.securityDashboard={refreshMetrics:n,config:t,startAutoRefresh:o,addTimestamp:a}}));