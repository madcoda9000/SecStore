document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("userForm"),t=document.getElementById("submitBtn"),s=document.getElementById("btnText"),n=document.getElementById("spinner"),d=(document.querySelectorAll(".role-checkbox"),document.getElementById("roleError")),a=document.querySelectorAll(".role-badge"),l=document.getElementById("rolesInput");function c(e){return d.style.display="none",0===e.length?(d.innerText=messages.error1,d.style.display="block",d.classList.add("text-danger"),d.classList.remove("text-info"),!1):e.includes("User")&&e.length>1?(d.innerText=messages.error2,d.style.display="block",d.classList.add("text-danger"),d.classList.remove("text-info"),!1):e.includes("Admin")&&e.length>1?(d.innerText=messages.error3,d.style.display="block",d.classList.add("text-danger"),d.classList.remove("text-info"),!1):(d.classList.add("text-info"),d.classList.remove("text-danger"),d.innerText=messages.error4,!0)}a.forEach((e=>{e.addEventListener("click",(function(){this.classList.toggle("selected"),this.classList.toggle("bg-primary"),this.classList.toggle("bg-secondary"),function(){let e=Array.from(document.querySelectorAll(".role-badge.selected")).map((e=>e.dataset.value));l.value=e.join(","),c(e)}()}))})),e.addEventListener("submit",(function(d){d.preventDefault();const a=l.value?l.value.split(","):[];e.checkValidity()&&c(a)?(t.disabled=!0,s.classList.add("d-none"),n.classList.remove("d-none"),fetch("/admin/createUser",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:new FormData(e)}).then((e=>e.json())).then((t=>{t.success?(showToast(`${t.message}`,"success","Success"),e.reset()):showToast(`${t.message}`,"danger","ERROR")})).catch((e=>{showToast(`${e}`,"danger","ERROR")})).finally((()=>{t.disabled=!1,s.classList.remove("d-none"),n.classList.add("d-none")}))):e.classList.add("was-validated")})),document.getElementById("togglePassword").addEventListener("click",(function(){let e=document.getElementById("password"),t=document.getElementById("togglePasswordIcon");"password"===e.type?(e.type="text",t.classList.add("text-danger"),t.classList.remove("text-success"),t.classList.remove("bi-eye"),t.classList.add("bi-eye-slash")):(e.type="password",t.classList.add("text-success"),t.classList.remove("text-danger"),t.classList.remove("bi-eye-slash"),t.classList.add("bi-eye"))})),document.getElementById("generatePassword").addEventListener("click",(function(){let e=document.getElementById("password"),t=function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&*()-_",t="";for(let s=0;s<16;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();e.value=t}));const o=document.getElementById("ldapEnabled"),r=document.getElementById("entraIdEnabled");o&&r&&(o.addEventListener("change",(function(){this.checked&&!r.disabled&&(r.checked=!1)})),r.addEventListener("change",(function(){this.checked&&!o.disabled&&(o.checked=!1)})))}));