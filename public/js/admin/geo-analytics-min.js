document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("geo-analytics-config");let e={},n={};if(t)try{e=JSON.parse(t.getAttribute("data-geo-data")||"{}"),n=JSON.parse(t.getAttribute("data-top-countries")||"{}")}catch(t){e={},n={}}function o(){setInterval((function(){fetch("/admin/geo/data?type=countries&days=30",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then((t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((t=>{var e;t.success&&(e=t.data,document.querySelector("table tbody")&&e.countries)})).catch((t=>{i("Failed to refresh geographic data")}))}),6e5)}function i(t){const e=document.createElement("div");e.className="alert alert-warning alert-dismissible fade show position-fixed",e.style.cssText="\n            top: 20px;\n            right: 20px;\n            z-index: 9999;\n            min-width: 300px;\n            max-width: 400px;\n        ",e.innerHTML=`\n            <i class="bi bi-exclamation-triangle"></i>\n            <strong>Geo-Analytics:</strong> ${t}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(e),setTimeout((()=>{e.parentElement&&e.remove()}),8e3)}document.querySelectorAll("[title]").forEach((t=>{t.addEventListener("mouseenter",(function(){})),t.addEventListener("mouseover",(function(){this.getAttribute("title")&&(this.setAttribute("data-bs-toggle","tooltip"),this.setAttribute("data-bs-placement","top"))}))})),o(),document.querySelectorAll('[data-action="refresh-geo"]').forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const e=this.innerHTML;this.innerHTML='<i class="bi bi-hourglass-split"></i> Refreshing...',this.disabled=!0,fetch("/admin/geo/data?type=full&days=30",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Refresh failed");setTimeout((()=>location.reload()),1e3)})).catch((t=>{i("Manual refresh failed")})).finally((()=>{this.innerHTML=e,this.disabled=!1}))}))})),function(){const t=document.getElementById("countryFilter");t&&t.addEventListener("input",(function(){const t=this.value.toLowerCase();document.querySelectorAll("table tbody tr").forEach((e=>{const n=e.querySelector("td:first-child");if(n){const o=n.textContent.toLowerCase();e.style.display=o.includes(t)?"":"none"}}))}))}(),document.querySelectorAll(".badge").forEach((t=>{t.textContent.toLowerCase().includes("high")&&t.addEventListener("click",(function(){}))})),window.geoAnalytics={data:{geoData:e,topCountriesData:n},refresh:o,config:t}}));