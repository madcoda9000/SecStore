document.addEventListener("DOMContentLoaded",(function(){document.getElementById("search").addEventListener("input",(function(){fetchRoles()})),document.getElementById("pageSize").addEventListener("change",(function(){fetchRoles()})),document.getElementById("pagination").addEventListener("click",(function(e){if(e.preventDefault(),"A"===e.target.tagName&&e.target.dataset.page){const t=parseInt(e.target.dataset.page);isNaN(t)||goToPage(t)}}))})),document.getElementById("rolesTableBody").addEventListener("click",(function(e){if(e.target.classList.contains("delete-role-btn")){confirmDelete(e.target.dataset.roleId,e.target.dataset.roleName)}})),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("search").addEventListener("input",(function(){fetchRoles()})),document.getElementById("pageSize").addEventListener("change",(function(){fetchRoles()})),document.getElementById("pagination").addEventListener("click",(function(e){if(e.preventDefault(),"A"===e.target.tagName&&e.target.dataset.page){const t=parseInt(e.target.dataset.page);isNaN(t)||goToPage(t)}}));const e=document.getElementById("addRoleBtn");e&&e.addEventListener("click",(function(){addRole()})),document.getElementById("rolesTableBody").addEventListener("click",(function(e){if(e.target.classList.contains("delete-role-btn")){confirmDelete(e.target.dataset.roleId,e.target.dataset.roleName)}}))}));let currentPage=1;function fetchRoles(){let e=document.getElementById("search").value,t=document.getElementById("pageSize").value,n=document.getElementById("loadingSpinner"),a=document.getElementById("rolesTableBody");n.style.display="block",a.innerHTML="",fetch(`/admin/roles?search=${e}&pageSize=${t}&page=${currentPage}`).then((e=>e.json())).then((e=>{a.innerHTML="",e.roles.forEach((e=>{let t=`<tr>\n            <td>${e.id}</td>\n            <td>${e.roleName}</td>\n            <td>\n                <button class="btn btn-danger btn-sm delete-role-btn" \n                        data-role-id="${e.id}" \n                        data-role-name="${e.roleName}">${messages.msg1}</button>\n            </td>\n        </tr>`;a.innerHTML+=t})),updatePagination(e.page,e.totalPages)})).catch((e=>{})).finally((()=>{n.style.display="none"}))}function updatePagination(e,t){let n=document.getElementById("pagination"),a=document.getElementById("paginationInfo");n.innerHTML="",a.textContent=`${messages.msg4} ${e} ${messages.msg5} ${t}`;let o=Math.max(1,e-Math.floor(2.5)),d=Math.min(t,o+5-1);if(e>1){let t=document.createElement("li");t.className="page-item",t.innerHTML=`<a class="page-link" href="#" data-page="${e-1}">&laquo;</a>`,n.appendChild(t)}if(o>1){let e=document.createElement("li");e.className="page-item",e.innerHTML='<a class="page-link" href="#" data-page="1">1</a>',n.appendChild(e),o>2&&(n.innerHTML+='<li class="page-item disabled"><span class="page-link">...</span></li>')}for(let t=o;t<=d;t++){let a=document.createElement("li");a.className="page-item "+(t===e?"active":""),a.innerHTML=`<a class="page-link" href="#" data-page="${t}">${t}</a>`,n.appendChild(a)}if(d<t){d<t-1&&(n.innerHTML+='<li class="page-item disabled"><span class="page-link">...</span></li>');let e=document.createElement("li");e.className="page-item",e.innerHTML=`<a class="page-link" href="#" data-page="${t}">${t}</a>`,n.appendChild(e)}if(e<t){let t=document.createElement("li");t.className="page-item",t.innerHTML=`<a class="page-link" href="#" data-page="${e+1}">&raquo;</a>`,n.appendChild(t)}}function goToPage(e){currentPage=e,fetchRoles()}function addRole(){let e=document.getElementById("newRoleName").value,t=new FormData;t.append("roleName",e),fetch("/admin/roles/add",{method:"POST",body:t}).then((()=>{fetchRoles(),document.getElementById("newRoleName").value="";const t=document.getElementById("addRoleModal"),n=bootstrap.Modal.getInstance(t);if(n)n.hide();else{new bootstrap.Modal(t).hide()}setTimeout((()=>{const e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""}),300),showToast(`${messages.msg6} "${e}" ${messages.msg7}`,"success","Success")}))}function confirmDelete(e,t){fetch(`/admin/roles/checkUsers?role=${t}`).then((e=>e.json())).then((n=>{if(n.inUse)showToast(`${messages.msg6} "${t}" ${messages.msg8}`,"warning","Warning");else{document.getElementById("deleteMessage").textContent=`${messages.msg9} "${t}" ${messages.msg10}`;const n=document.getElementById("deleteConfirmBtn");n.replaceWith(n.cloneNode(!0));document.getElementById("deleteConfirmBtn").addEventListener("click",(function(){deleteRole(e)})),new bootstrap.Modal(document.getElementById("confirmDeleteModal")).show()}}))}function deleteRole(e){let t=document.getElementById("deleteMessage").textContent.match(/"([^"]+)"/)[1],n=new FormData;n.append("roleId",e),fetch("/admin/roles/delete",{method:"POST",body:n}).then((()=>{fetchRoles();const e=document.getElementById("confirmDeleteModal"),n=bootstrap.Modal.getInstance(e);if(n)n.hide();else{new bootstrap.Modal(e).hide()}setTimeout((()=>{const e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""}),300),showToast(`${messages.msg6} "${t}" ${messages.msg11}`,"success","Success")}))}