document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("userForm"),t=document.getElementById("submitBtn"),s=document.getElementById("btnText"),r=document.getElementById("spinner"),n=document.querySelectorAll(".role-badge"),o=document.getElementById("rolesInput");function d(e){return roleError.style.display="none",0===e.length?(roleError.innerText=messages.error1,roleError.style.display="block",roleError.classList.add("text-danger"),roleError.classList.remove("text-info"),!1):e.includes("User")&&e.length>1?(roleError.innerText=messages.error2,roleError.style.display="block",roleError.classList.add("text-danger"),roleError.classList.remove("text-info"),!1):e.includes("Admin")&&e.length>1?(roleError.innerText=messages.error4,roleError.style.display="block",roleError.classList.add("text-danger"),roleError.classList.remove("text-info"),!1):(roleError.classList.add("text-info"),roleError.classList.remove("text-danger"),roleError.innerText=messages.error4,!0)}n.forEach((e=>{e.addEventListener("click",(function(){this.classList.toggle("selected"),this.classList.toggle("bg-primary"),this.classList.toggle("bg-secondary"),function(){let e=Array.from(document.querySelectorAll(".role-badge.selected")).map((e=>e.dataset.value));o.value=e.join(","),d(e)}()}))})),e.addEventListener("submit",(function(n){n.preventDefault();const a=o.value?o.value.split(","):[];e.checkValidity()&&d(a)?(t.disabled=!0,s.classList.add("d-none"),r.classList.remove("d-none"),fetch("/admin/updateUser",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:new FormData(e)}).then((e=>e.json())).then((e=>{e.success?showToast(`${e.message}`,"success","Success"):showToast(`${e.message}`,"danger","ERROR")})).catch((e=>{showToast(`${e}`,"danger","ERROR")})).finally((()=>{t.disabled=!1,s.classList.remove("d-none"),r.classList.add("d-none")}))):e.classList.add("was-validated")})),document.getElementById("togglePassword").addEventListener("click",(function(){let e=document.getElementById("password"),t=document.getElementById("togglePasswordIcon");"password"===e.type?(e.type="text",t.classList.add("text-danger"),t.classList.remove("text-success"),t.classList.remove("bi-eye"),t.classList.add("bi-eye-slash")):(e.type="password",t.classList.add("text-success"),t.classList.remove("text-danger"),t.classList.remove("bi-eye-slash"),t.classList.add("bi-eye"))})),document.getElementById("generatePassword").addEventListener("click",(function(){let e=document.getElementById("password"),t=function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&*()-_",t="";for(let s=0;s<16;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();e.value=t}));const a=document.getElementById("ldapEnabled"),l=document.getElementById("entraIdEnabled");a&&l&&(a.addEventListener("change",(function(){this.checked&&!l.disabled&&(l.checked=!1)})),l.addEventListener("change",(function(){this.checked&&!a.disabled&&(a.checked=!1)})))}));