document.addEventListener('DOMContentLoaded',function(){const a=document.getElementById('exportDataBtn'),b=document.getElementById('requestDeleteBtn'),c=document.getElementById('cancelDeleteBtn'),d=document.getElementById('confirmDeleteBtn'),e=document.getElementById('confirmCancelBtn'),f=new bootstrap.Modal(document.getElementById('deleteConfirmModal')),g=new bootstrap.Modal(document.getElementById('cancelDeleteModal')),h=document.getElementById('csrf-token').value;function i(a,b,c){const d=document.querySelector('.toast-container')||j(),e={success:'check-circle-fill',error:'exclamation-triangle-fill',warning:'exclamation-triangle-fill',info:'info-circle-fill'},f={success:'bg-success',error:'bg-danger',warning:'bg-warning',info:'bg-info'},g=`<div class="toast align-items-center text-white ${f[a]} border-0" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body"><i class="bi bi-${e[a]} me-2"></i><strong>${b}</strong><br>${c}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div></div>`;d.insertAdjacentHTML('beforeend',g);const h=d.lastElementChild,k=new bootstrap.Toast(h,{delay:5e3});k.show(),h.addEventListener('hidden.bs.toast',function(){h.remove()})}function j(){const a=document.createElement('div');return a.className='toast-container position-fixed top-0 end-0 p-3',a.style.zIndex='9999',document.body.appendChild(a),a}a&&a.addEventListener('click',function(){const a=this.innerHTML;this.disabled=!0,this.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Exporting...',window.location.href='/privacy/export',setTimeout(()=>{this.disabled=!1,this.innerHTML=a,i('success','Data export started','Your data export has been downloaded.')},2e3)}),b&&b.addEventListener('click',function(){f.show()}),d&&d.addEventListener('click',function(){const a=this.innerHTML;this.disabled=!0,this.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Processing...',fetch('/privacy/request-deletion',{method:'POST',headers:{'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'},body:JSON.stringify({csrf_token:h})}).then(a=>a.json()).then(b=>{b.success?(f.hide(),i('success','Deletion Request Sent',b.message),setTimeout(()=>{window.location.reload()},2e3)):(i('error','Error',b.message),this.disabled=!1,this.innerHTML=a)}).catch(b=>{console.error('Error:',b),i('error','Error','An unexpected error occurred. Please try again.'),this.disabled=!1,this.innerHTML=a})}),c&&c.addEventListener('click',function(){g.show()}),e&&e.addEventListener('click',function(){const a=this.innerHTML;this.disabled=!0,this.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Processing...',fetch('/privacy/cancel-deletion',{method:'POST',headers:{'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'},body:JSON.stringify({csrf_token:h})}).then(a=>a.json()).then(b=>{b.success?(g.hide(),i('success','Deletion Cancelled',b.message),setTimeout(()=>{window.location.reload()},2e3)):(i('error','Error',b.message),this.disabled=!1,this.innerHTML=a)}).catch(b=>{console.error('Error:',b),i('error','Error','An unexpected error occurred. Please try again.'),this.disabled=!1,this.innerHTML=a})})});
