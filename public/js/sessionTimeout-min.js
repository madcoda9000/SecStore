window.sessionTimeout=function(e){const t=Object.assign({appendTimestamp:!1,keepAliveMethod:"POST",keepAliveUrl:"/keep-alive",logOutBtnText:"Log out now",logOutUrl:"/log-out",message:"Your session is about to expire.",stayConnectedBtnText:"Stay connected",timeOutAfter:12e5,timeOutUrl:"/timed-out",titleText:"Session Timeout",warnAfter:9e5,showCountDownTimer:!1,showCountDownTimerInDialog:!1,countDownTimerInDialogId:"remainingTimeInDialog",countDownTimerId:"remainingTime"},e);let n,o,i,s=document.getElementById(t.countDownTimerId),a=Date.now()+t.timeOutAfter,l=null;const d=()=>{let e=Math.max(0,Math.round((a-Date.now())/1e3)),n=Math.floor(e/60),o=e%60,l=`${String(n).padStart(2,"0")}:${String(o).padStart(2,"0")}`;if(s&&(s.innerText=l),t.showCountDownTimerInDialog){const e=document.getElementById(t.countDownTimerInDialogId);e&&(e.innerText=l)}e<=0&&clearInterval(i)},r=()=>{const e=`\n      <div class="modal fade" id="sessionTimeoutModal" tabindex="-1" aria-labelledby="sessionTimeoutModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">\n        <div class="modal-dialog modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header bg-warning text-dark">\n              <h5 class="modal-title" id="sessionTimeoutModalLabel">\n                <i class="bi bi-clock-history me-2"></i>${t.titleText}\n              </h5>\n            </div>\n            <div class="modal-body text-center">\n              <div class="mb-3">\n                <i class="bi bi-exclamation-triangle-fill text-warning fs-1 mb-3"></i>\n              </div>\n              <p class="fs-5 mb-3">${t.message}</p>\n              ${t.showCountDownTimerInDialog?`\n                <div class="alert alert-warning" role="alert">\n                  <i class="bi bi-stopwatch me-2"></i>\n                  Time remaining: <strong><span id="${t.countDownTimerInDialogId}" class="text-danger fs-4">00:00</span></strong>\n                </div>\n              `:""}\n              <div class="text-muted">\n                <small>Your session will expire automatically if no action is taken.</small>\n              </div>\n            </div>\n            <div class="modal-footer justify-content-center">\n              <button type="button" class="btn btn-outline-secondary me-3" id="sessionTimeoutLogoutBtn">\n                <i class="bi bi-box-arrow-right me-2"></i>${t.logOutBtnText}\n              </button>\n              <button type="button" class="btn btn-primary" id="sessionTimeoutStayConnectedBtn">\n                <i class="bi bi-arrow-clockwise me-2"></i>${t.stayConnectedBtnText}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,n=document.getElementById("sessionTimeoutModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",e);const o=document.getElementById("sessionTimeoutModal");return l=new bootstrap.Modal(o,{backdrop:"static",keyboard:!1}),document.getElementById("sessionTimeoutLogoutBtn").addEventListener("click",u),document.getElementById("sessionTimeoutStayConnectedBtn").addEventListener("click",w),o},c=()=>{l||r(),l.show()},m=()=>{window.location=t.timeOutUrl},u=()=>{window.location=t.logOutUrl},w=()=>{const e=document.getElementById("sessionTimeoutStayConnectedBtn"),n=document.getElementById("sessionTimeoutLogoutBtn");e.disabled=!0,n.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Connecting...';const o=t.appendTimestamp?`${t.keepAliveUrl}?time=${Date.now()}`:t.keepAliveUrl,i=new XMLHttpRequest;i.onload=function(){if(200===i.status)try{!0===JSON.parse(i.responseText).success?T():b("Server rejected session extension")}catch(e){b("Invalid server response")}else b(`Server error: ${i.status}`)},i.onerror=()=>b("Network error - check connection"),i.ontimeout=()=>b("Request timeout - server slow"),i.timeout=1e4,i.open(t.keepAliveMethod,o),i.send()},T=()=>{a=Date.now()+t.timeOutAfter,l.hide(),n=setTimeout(c,t.warnAfter),clearTimeout(o),o=setTimeout(m,t.timeOutAfter),g("Session extended successfully","success")},b=e=>{window.location=t.logOutUrl},g=(e,t)=>{"function"==typeof window.showToast&&window.showToast(e,"success"===t?"success":"danger","Session")};r(),n=setTimeout(c,t.warnAfter),o=setTimeout(m,t.timeOutAfter),t.showCountDownTimer&&(i=setInterval(d,1e3),d())};