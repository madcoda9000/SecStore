document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".otp-input"),t=document.getElementById("otp-hidden"),n=document.getElementById("otp-submit"),a=document.getElementById("otp-form"),i=document.getElementById("backup-form"),o=document.getElementById("toggle-backup-code"),c=document.getElementById("verify-subtitle"),l=document.getElementById("2fa-verify-messages");let s=!1;if(e.length>0){function u(){if(Array.from(e).every((e=>1===e.value.length))){const a=Array.from(e).map((e=>e.value)).join("");t.value=a,n.disabled=!1}else n.disabled=!0}e.forEach(((t,n)=>{t.addEventListener("input",(function(t){1===this.value.length&&(n<e.length-1&&e[n+1].focus(),u())})),t.addEventListener("keydown",(function(t){"Backspace"===t.key&&""===this.value&&n>0&&e[n-1].focus()})),t.addEventListener("keypress",(function(e){/[0-9]/.test(e.key)||e.preventDefault()})),t.addEventListener("paste",(function(t){t.preventDefault();const n=t.clipboardData.getData("text").trim().replace(/\D/g,"").slice(0,6);n.split("").forEach(((t,n)=>{e[n]&&(e[n].value=t)})),6===n.length&&e[5].focus(),u()}))})),a.addEventListener("submit",(function(n){const a=Array.from(e).map((e=>e.value)).join("");t.value=a}))}o&&a&&i&&o.addEventListener("click",(function(t){if(t.preventDefault(),s=!s,s){a.style.display="none",i.style.display="block",o.innerHTML='<i class="bi bi-phone"></i> '+(l?l.getAttribute("data-back-to-code"):"Back to authenticator code"),c&&l&&(c.textContent=l.getAttribute("data-subtitle-backup"));const e=document.getElementById("backup-code-input");e&&e.focus()}else a.style.display="block",i.style.display="none",o.innerHTML='<i class="bi bi-key"></i> '+(l?l.getAttribute("data-use-backup"):"Use backup code instead"),c&&l&&(c.textContent=l.getAttribute("data-subtitle-otp")),e[0]&&e[0].focus()}));const d=document.getElementById("backup-code-input");d&&(d.addEventListener("input",(function(e){let t=this.value.replace(/[^A-Za-z0-9]/g,"").toUpperCase();t.length>4&&(t=t.slice(0,4)+"-"+t.slice(4,8)),this.value=t})),d.addEventListener("paste",(function(e){e.preventDefault();const t=e.clipboardData.getData("text").trim().toUpperCase().replace(/[^A-Za-z0-9]/g,"");t.length>=4?this.value=t.slice(0,4)+"-"+t.slice(4,8):this.value=t})))}));