document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("truncateLogsBtn"),t=document.getElementById("exportFirstBtn"),n=document.getElementById("confirmTruncateBtn"),o=document.getElementById("exportLogsBtn");if(!e)return;const d=document.getElementById("log-config"),s=document.getElementById("truncate-messages"),c=d.dataset.type.toUpperCase(),a=s.dataset.confirm,r=s.dataset.success,i=s.dataset.error,l=new bootstrap.Modal(document.getElementById("truncateModal"));function u(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');return t?t.value:""}function m(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show position-fixed`,n.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",n.innerHTML=`\n      ${e}\n      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    `,document.body.appendChild(n),setTimeout((()=>{n.parentElement&&n.remove()}),5e3)}e.addEventListener("click",(function(){const e=a.replace("{type}",c);document.getElementById("truncateConfirmText").textContent=e,l.show()})),t.addEventListener("click",(function(){l.hide(),o&&o.click()})),n.addEventListener("click",(function(){n.disabled=!0,t.disabled=!0;const e=document.querySelector("#truncateModal .btn-secondary");e&&(e.disabled=!0);const o=n.innerHTML;n.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>LÃ¶schen...',fetch("/admin/logs/truncate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({logType:c,csrf_token:u()})}).then((e=>e.json())).then((d=>{if(d.success){m(r.replace("{count}",d.count),"success"),l.hide(),setTimeout((()=>{window.location.reload()}),1500)}else m(d.message||i,"danger"),n.disabled=!1,t.disabled=!1,e&&(e.disabled=!1),n.innerHTML=o})).catch((d=>{m(i,"danger"),n.disabled=!1,t.disabled=!1,e&&(e.disabled=!1),n.innerHTML=o}))}))}));