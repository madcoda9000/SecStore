let currentPage=1,messages={},config={};function initializeLogPage(){loadMessages(),loadConfig(),setupEventListeners(),config.autoFetch&&fetchLogs()}function loadMessages(){const e=document.getElementById("log-messages");messages=e?{msg4:e.dataset.msg4||"Page",msg5:e.dataset.msg5||"of",msg6:e.dataset.msg6||"Error loading logs"}:{msg4:"Page",msg5:"of",msg6:"Error loading logs"}}function loadConfig(){const e=document.getElementById("log-config");config=e?{type:e.dataset.type||"unknown",fetchUrl:e.dataset.fetchUrl||"/admin/logs/fetch",autoFetch:"true"===e.dataset.autoFetch}:{type:"unknown",fetchUrl:"/admin/logs/fetch",autoFetch:!0}}function setupEventListeners(){const e=document.getElementById("search"),t=document.getElementById("pageSize");e&&e.addEventListener("input",debounce(fetchLogs,300)),t&&t.addEventListener("change",(function(){currentPage=1,fetchLogs()})),setupPaginationEventDelegation()}function setupPaginationEventDelegation(){const e=document.getElementById("pagination");e&&e.addEventListener("click",(function(e){if(e.preventDefault(),"A"===e.target.tagName&&e.target.hasAttribute("data-page")){const t=parseInt(e.target.getAttribute("data-page"));!isNaN(t)&&t>0&&goToPage(t)}}))}function fetchLogs(){const e=document.getElementById("search")?.value||"",t=document.getElementById("pageSize")?.value||10,n=(document.getElementById("loadingSpinner"),document.getElementById("logTableBody")),a=document.getElementById("logCardsBody");if(!config.fetchUrl)return void showError("Configuration error: Fetch URL not found");showLoading(!0),n&&(n.innerHTML=""),a&&(a.innerHTML="");const o=`${config.fetchUrl}?search=${encodeURIComponent(e)}&pageSize=${t}&page=${currentPage}`;fetch(o).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()})).then((e=>{e.logs&&Array.isArray(e.logs)?(populateTable(e.logs),populateCards(e.logs),updatePagination(e.page||1,e.totalPages||1)):showError("Invalid data format received from server")})).catch((e=>{showError(messages.msg6||"Error loading logs")})).finally((()=>{showLoading(!1)}))}function populateTable(e){const t=document.getElementById("logTableBody");t&&(t.innerHTML="",0!==e.length?e.forEach((e=>{const n=document.createElement("tr");n.innerHTML=`\n            <td>${escapeHtml(e.id||"")}</td>\n            <td><span class="badge bg-secondary">${escapeHtml(e.type||"")}</span></td>\n            <td>${escapeHtml(e.datum_zeit||"")}</td>\n            <td>${escapeHtml(e.user||"")}</td>\n            <td>${escapeHtml(e.context||"")}</td>\n            <td>${escapeHtml(e.message||"")}</td>\n        `,t.appendChild(n)})):t.innerHTML='\n            <tr>\n                <td colspan="6" class="text-center text-muted py-4">\n                    <i class="bi bi-info-circle"></i> No logs found\n                </td>\n            </tr>\n        ')}function populateCards(e){const t=document.getElementById("logCardsBody");t&&(t.innerHTML="",0!==e.length?e.forEach((e=>{const n=document.createElement("div");n.className="card mb-2 p-2",n.innerHTML=`\n            <div><strong>#${escapeHtml(e.id||"")}</strong></div>\n            <div><strong>Type:</strong> <span class="badge bg-secondary">${escapeHtml(e.type||"")}</span></div>\n            <div><strong>Date:</strong> ${escapeHtml(e.datum_zeit||"")}</div>\n            <div><strong>User:</strong> ${escapeHtml(e.user||"")}</div>\n            <div><strong>Context:</strong> ${escapeHtml(e.context||"")}</div>\n            <div><strong>Message:</strong> ${escapeHtml(e.message||"")}</div>\n        `,t.appendChild(n)})):t.innerHTML='\n            <div class="alert alert-info">\n                <i class="bi bi-info-circle"></i> No logs found\n            </div>\n        ')}function updatePagination(e,t){const n=document.getElementById("pagination"),a=document.getElementById("paginationInfo");if(!n)return;if(n.innerHTML="",a&&(a.textContent=`${messages.msg4} ${e} ${messages.msg5} ${t}`),t<=1)return;const o=Math.max(1,e-Math.floor(2.5)),s=Math.min(t,o+5-1);if(e>1){const t=document.createElement("li");t.className="page-item",t.innerHTML=`<a class="page-link" href="#" data-page="${e-1}" title="Previous Page">&laquo;</a>`,n.appendChild(t)}if(o>1){const e=document.createElement("li");if(e.className="page-item",e.innerHTML='<a class="page-link" href="#" data-page="1">1</a>',n.appendChild(e),o>2){const e=document.createElement("li");e.className="page-item disabled",e.innerHTML='<span class="page-link">...</span>',n.appendChild(e)}}for(let t=o;t<=s;t++){const a=document.createElement("li");a.className="page-item "+(t===e?"active":""),a.innerHTML=`<a class="page-link" href="#" data-page="${t}">${t}</a>`,n.appendChild(a)}if(s<t){if(s<t-1){const e=document.createElement("li");e.className="page-item disabled",e.innerHTML='<span class="page-link">...</span>',n.appendChild(e)}const e=document.createElement("li");e.className="page-item",e.innerHTML=`<a class="page-link" href="#" data-page="${t}">${t}</a>`,n.appendChild(e)}if(e<t){const t=document.createElement("li");t.className="page-item",t.innerHTML=`<a class="page-link" href="#" data-page="${e+1}" title="Next Page">&raquo;</a>`,n.appendChild(t)}}function goToPage(e){e&&e>0&&(currentPage=e,fetchLogs(),window.scrollTo({top:0,behavior:"smooth"}))}function showLoading(e){const t=document.getElementById("loadingSpinner");t&&(t.style.display=e?"block":"none")}function showError(e){const t=document.getElementById("logTableBody"),n=document.getElementById("logCardsBody");t&&(t.innerHTML=`\n            <tr>\n                <td colspan="6" class="text-center text-danger py-4">\n                    <i class="bi bi-exclamation-triangle"></i> ${escapeHtml(e)}\n                </td>\n            </tr>\n        `),n&&(n.innerHTML=`\n            <div class="alert alert-danger">\n                <i class="bi bi-exclamation-triangle"></i> ${escapeHtml(e)}\n            </div>\n        `)}function escapeHtml(e){if("string"!=typeof e)return e||"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),e(...a)}),t)}}document.addEventListener("DOMContentLoaded",(function(){initializeLogPage()})),window.goToPage=goToPage,window.fetchLogs=fetchLogs;