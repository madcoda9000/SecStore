<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>Test Documentation</title>
        <style>
            body {
                text-rendering: optimizeLegibility;
                font-family: Source SansSerif Pro, Arial, sans-serif;
                font-variant-ligatures: common-ligatures;
                font-kerning: normal;
                margin-left: 2rem;
                background-color: #fff;
                color: #000;
            }

            body > ul > li {
                font-size: larger;
            }

            h2 {
                font-size: larger;
                text-decoration-line: underline;
                text-decoration-thickness: 2px;
                margin: 0;
                padding: 0.5rem 0;
            }

            ul {
                list-style: none;
                margin: 0 0 2rem;
                padding: 0 0 0 1rem;
                text-indent: -1rem;
            }

            .success:before {
                color: #4e9a06;
                content: '✓';
                padding-right: 0.5rem;
            }

            .defect {
                color: #a40000;
            }

            .defect:before {
                color: #a40000;
                content: '✗';
                padding-right: 0.5rem;
            }
        </style>
    </head>
    <body>
        <h2>Auth Check Middleware (Tests\Unit\AuthCheckMiddleware)</h2>
        <ul>
            <li class="success">It allows authenticated user</li>
            <li class="success">It detects unauthenticated user</li>
            <li class="success">It detects empty user session</li>
            <li class="success">It recognizes user with complete session data</li>
            <li class="success">It recognizes user with minimal session data</li>
            <li class="success">It validates session structure</li>
        </ul>
        <h2>Authentication (Tests\Integration\Authentication)</h2>
        <ul>
            <li class="success">It validates login credentials</li>
            <li class="success">It rejects empty credentials</li>
            <li class="success">It validates password complexity</li>
            <li class="success">It creates session on successful login</li>
            <li class="success">It destroys session on logout</li>
            <li class="defect">It regenerates session id on login</li>
            <li class="success">It tracks failed login attempts</li>
            <li class="success">It enforces account lockout after max attempts</li>
            <li class="success">It resets failed attempts on successful login</li>
            <li class="success">It validates session timeout</li>
            <li class="success">It handles 2 fa flow</li>
            <li class="success">It completes 2 fa verification</li>
        </ul>
        <h2>Cors Util (Tests\Unit\CorsUtil)</h2>
        <ul>
            <li class="success">Set and get allowed hosts</li>
            <li class="success">Allow origins adds header when origin allowed</li>
            <li class="success">Allow origins does nothing when origin not allowed</li>
            <li class="success">Setup cors handles options request</li>
        </ul>
        <h2>Input Validator (Tests\Unit\InputValidator)</h2>
        <ul>
            <li class="success">It validates required fields</li>
            <li class="success">It rejects missing required field</li>
            <li class="success">It rejects empty string for required field</li>
            <li class="success">It rejects null for required field</li>
            <li class="success">It allows empty values for optional fields</li>
            <li class="success">It validates correct email format</li>
            <li class="success">It rejects invalid email formats</li>
            <li class="success">It validates minimum length</li>
            <li class="success">It rejects strings below minimum length</li>
            <li class="success">It validates maximum length</li>
            <li class="success">It rejects strings exceeding maximum length</li>
            <li class="success">It validates both min and max length</li>
            <li class="success">It validates numeric values</li>
            <li class="success">It rejects non numeric values</li>
            <li class="success">It validates integer values</li>
            <li class="success">It rejects non integer values</li>
            <li class="success">It validates boolean values</li>
            <li class="success">It rejects invalid boolean values</li>
            <li class="success">It validates alpha only strings</li>
            <li class="success">It rejects non alpha strings</li>
            <li class="success">It validates alphanumeric strings</li>
            <li class="success">It rejects non alphanumeric strings</li>
            <li class="success">It validates strong passwords</li>
            <li class="success">It rejects passwords too short</li>
            <li class="success">It rejects passwords without uppercase</li>
            <li class="success">It rejects passwords without lowercase</li>
            <li class="success">It rejects passwords without numbers</li>
            <li class="success">It rejects passwords without special characters</li>
            <li class="success">It validates correct username format</li>
            <li class="success">It rejects username too short</li>
            <li class="success">It rejects username too long</li>
            <li class="success">It rejects username with invalid characters</li>
            <li class="success">It rejects username starting with special char</li>
            <li class="success">It rejects username ending with special char</li>
            <li class="success">It validates correct otp format</li>
            <li class="success">It rejects otp with wrong length</li>
            <li class="success">It rejects otp with non numeric characters</li>
            <li class="success">It validates correct url format</li>
            <li class="success">It rejects invalid url format</li>
            <li class="success">It validates correct role name</li>
            <li class="success">It rejects role name too short</li>
            <li class="success">It rejects role name too long</li>
            <li class="success">It validates value in allowed list</li>
            <li class="success">It rejects value not in allowed list</li>
            <li class="success">It validates value not in blacklist</li>
            <li class="success">It rejects value in blacklist</li>
            <li class="success">It validates value matching regex</li>
            <li class="success">It rejects value not matching regex</li>
            <li class="success">It trims whitespace from strings</li>
            <li class="success">It encodes html special characters</li>
            <li class="success">It validates multiple rules on single field</li>
            <li class="success">It validates multiple fields</li>
            <li class="success">It returns partial results in non strict mode</li>
            <li class="success">It has login rules definition</li>
            <li class="success">It has registration rules definition</li>
            <li class="success">It has password reset rules definition</li>
            <li class="success">It has 2 fa verification rules definition</li>
            <li class="success">It has admin user rules definition</li>
            <li class="success">It handles empty rules array</li>
            <li class="success">It handles empty data array</li>
            <li class="success">It validates complex real world scenario</li>
        </ul>
        <h2>Ldap Util (Tests\Unit\LdapUtil)</h2>
        <ul>
            <li class="success">It has default configuration values</li>
            <li class="success">It validates ldap port is within valid range</li>
            <li class="success">It uses standard ldap ports</li>
            <li class="success">It validates ldap host format</li>
            <li class="success">It validates timeout is reasonable</li>
            <li class="success">It validates domain prefix format</li>
            <li class="success">It rejects empty username</li>
            <li class="success">It rejects empty password</li>
            <li class="success">It rejects both empty credentials</li>
            <li class="success">It rejects whitespace only username</li>
            <li class="success">It rejects whitespace only password</li>
            <li class="success">It handles null username safely</li>
            <li class="success">It handles null password safely</li>
            <li class="success">It constructs bind dn with domain prefix</li>
            <li class="success">It constructs bind dn without domain prefix</li>
            <li class="success">It handles special characters in username</li>
            <li class="success">It preserves case in username</li>
            <li class="success">It validates ldap injection attempts</li>
            <li class="success">It handles missing config file gracefully</li>
            <li class="success">It validates ldap host is not empty</li>
            <li class="success">It uses ldap protocol version 3</li>
            <li class="success">It has reasonable network timeout</li>
            <li class="success">It returns boolean from authenticate</li>
            <li class="success">It returns false for invalid input</li>
            <li class="defect">It documents integration test requirements</li>
        </ul>
        <h2>Log Util (Tests\Unit\LogUtil)</h2>
        <ul>
            <li class="success">It loads configuration lazily</li>
            <li class="success">It does not reload configuration if already loaded</li>
            <li class="success">It loads logging configuration with all flags</li>
            <li class="success">It validates all log types exist</li>
            <li class="success">It creates log types from enum</li>
            <li class="success">It determines if sql logging is enabled</li>
            <li class="success">It determines if request logging is enabled</li>
            <li class="success">It always logs error type regardless of config</li>
            <li class="success">It validates log type filtering logic</li>
            <li class="success">It extracts ip from remote addr</li>
            <li class="success">It prefers x forwarded for if available</li>
            <li class="success">It handles multiple ips in x forwarded for</li>
            <li class="success">It falls back to unknown if no ip available</li>
            <li class="success">It validates ipv 4 addresses</li>
            <li class="success">It validates ipv 6 addresses</li>
            <li class="success">It formats context string correctly</li>
            <li class="success">It handles empty method in context</li>
            <li class="success">It handles nested file paths in context</li>
            <li class="success">It creates log directory if not exists</li>
            <li class="success">It uses correct file permissions for log directory</li>
            <li class="success">It formats log message with timestamp</li>
            <li class="success">It appends to log file</li>
            <li class="success">It uses file locking when writing</li>
            <li class="success">It validates log message is string</li>
            <li class="success">It handles empty log messages</li>
            <li class="success">It handles multiline log messages</li>
            <li class="success">It handles unicode in log messages</li>
            <li class="success">It defaults to anonymous user when no session</li>
            <li class="success">It extracts username from session</li>
            <li class="success">It formats datetime correctly</li>
            <li class="success">It uses consistent datetime format</li>
            <li class="success">It validates pagination parameters</li>
            <li class="success">It calculates offset correctly</li>
            <li class="success">It handles very long log messages</li>
            <li class="success">It handles special characters in context</li>
            <li class="success">It validates log type enum values are strings</li>
        </ul>
        <h2>Login Analytics (Tests\Unit\LoginAnalytics)</h2>
        <ul>
            <li class="success">It creates heatmap matrix with correct dimensions</li>
            <li class="success">It initializes heatmap matrix with zeros</li>
            <li class="success">It populates heatmap matrix correctly</li>
            <li class="success">It validates day of week indices</li>
            <li class="success">It validates hour of day indices</li>
            <li class="success">It finds peak activity slot</li>
            <li class="success">It handles multiple equal peaks</li>
            <li class="success">It handles matrix with no activity</li>
            <li class="success">It formats peak activity with readable names</li>
            <li class="success">It finds quiet periods</li>
            <li class="success">It identifies low activity as quiet</li>
            <li class="success">It creates hourly distribution structure</li>
            <li class="success">It formats hour labels correctly</li>
            <li class="success">It calculates login distribution correctly</li>
            <li class="success">It calculates success rate correctly</li>
            <li class="success">It formats week labels correctly</li>
            <li class="success">It validates week date ranges</li>
            <li class="success">It detects unusual login spikes</li>
            <li class="success">It detects unusual time periods</li>
            <li class="success">It detects unusual failed login ratio</li>
            <li class="success">It returns valid heatmap data structure</li>
            <li class="success">It returns valid hourly data structure</li>
            <li class="success">It handles zero logins</li>
            <li class="success">It handles very high login counts</li>
            <li class="success">It handles timestamps across different timezones</li>
            <li class="success">It validates days parameter range</li>
            <li class="success">It calculates date ranges correctly</li>
            <li class="success">It handles month boundaries correctly</li>
        </ul>
        <h2>Login Flow (Tests\Feature\LoginFlow)</h2>
        <ul>
            <li class="success">User can complete full login flow</li>
            <li class="success">User with 2 fa completes full flow</li>
            <li class="success">Failed login tracks attempts</li>
            <li class="success">Account locks after max failed attempts</li>
            <li class="success">Session expires after timeout</li>
            <li class="success">Logout clears all session data</li>
        </ul>
        <h2>Mail Util (Tests\Unit\MailUtil)</h2>
        <ul>
            <li class="success">It loads configuration lazily</li>
            <li class="success">It does not reload configuration if already loaded</li>
            <li class="success">It loads mail configuration with required keys</li>
            <li class="success">It validates smtp configuration structure</li>
            <li class="success">It has valid smtp port numbers</li>
            <li class="success">It has valid encryption type</li>
            <li class="success">It has valid email format for from address</li>
            <li class="success">It validates recipient email format</li>
            <li class="success">It validates subject is not empty</li>
            <li class="success">It validates template names</li>
            <li class="success">It validates template data is array</li>
            <li class="success">It respects enable welcome mail flag</li>
            <li class="success">It validates welcome mail logic</li>
            <li class="success">It sends non welcome emails regardless of flag</li>
            <li class="success">It handles invalid smtp credentials gracefully</li>
            <li class="success">It handles missing mail configuration</li>
            <li class="success">It handles invalid port number</li>
            <li class="success">It uses reasonable smtp timeout</li>
            <li class="success">It handles special characters in subject</li>
            <li class="success">It handles unicode in subject</li>
            <li class="success">It handles empty from name gracefully</li>
            <li class="success">It validates smtp host format</li>
            <li class="success">It handles different encryption methods</li>
            <li class="success">It constructs valid template path</li>
            <li class="success">It validates template file extension</li>
            <li class="success">It has complete mail configuration for sending</li>
            <li class="success">It validates complete email send parameters</li>
            <li class="success">It constructs valid log messages</li>
        </ul>
        <h2>Rate Limiter (Tests\Unit\RateLimiter)</h2>
        <ul>
            <li class="success">It initializes with default limits</li>
            <li class="success">It accepts custom limits</li>
            <li class="success">It allows requests within limit</li>
            <li class="success">It tracks request count correctly</li>
            <li class="success">It returns correct status information</li>
            <li class="success">It uses global limit as fallback</li>
            <li class="success">It has correct default limits</li>
            <li class="success">It stores requests in session</li>
            <li class="success">It maintains separate limits for different types</li>
            <li class="success">It handles zero requests correctly</li>
            <li class="success">It calculates remaining requests correctly</li>
            <li class="success">It generates consistent identifier for same client</li>
            <li class="success">It handles missing user agent gracefully</li>
            <li class="success">It provides window reset timestamp</li>
            <li class="success">It handles concurrent limit types</li>
        </ul>
        <h2>Security Metrics (Tests\Unit\SecurityMetrics)</h2>
        <ul>
            <li class="success">It calculates perfect security score</li>
            <li class="success">It reduces score for moderate failed logins</li>
            <li class="success">It reduces score for high failed logins</li>
            <li class="success">It reduces score for csrf violations</li>
            <li class="success">It caps csrf violation penalty at 30</li>
            <li class="success">It reduces score for high severity alerts</li>
            <li class="success">It reduces score for medium severity alerts</li>
            <li class="success">It combines multiple penalties</li>
            <li class="success">It never returns negative security score</li>
            <li class="success">It detects no alerts for normal activity</li>
            <li class="success">It detects excessive failed logins alert</li>
            <li class="success">It detects csrf violations alert</li>
            <li class="success">It detects suspicious activity alert</li>
            <li class="success">It detects multiple alerts simultaneously</li>
            <li class="success">It includes recommendations in alerts</li>
            <li class="success">It identifies suspicious ips from failed logins</li>
            <li class="success">It identifies multiple suspicious ips</li>
            <li class="success">It handles no suspicious activity</li>
            <li class="success">It returns valid summary structure</li>
            <li class="success">It returns valid alert structure</li>
            <li class="success">It handles zero login attempts</li>
            <li class="success">It handles null suspicious activity</li>
            <li class="success">It handles boundary value for failed logins</li>
        </ul>
        <h2>Session Util (Tests\Unit\SessionUtil)</h2>
        <ul>
            <li class="success">It can set and get session value</li>
            <li class="success">It returns null for nonexistent key</li>
            <li class="success">It can remove session value</li>
            <li class="success">It can check if key exists</li>
            <li class="success">It can destroy session</li>
            <li class="success">It generates unique csrf tokens</li>
            <li class="success">It validates csrf tokens correctly</li>
            <li class="success">It stores user in session</li>
            <li class="success">It handles session timeout calculation</li>
        </ul>
        <h2>Sodium Encryption (Tests\Unit\SodiumEncryption)</h2>
        <ul>
            <li class="success">It generates key with correct length</li>
            <li class="success">It generates unique keys</li>
            <li class="success">It generates cryptographically random keys</li>
            <li class="success">It encodes key to base 64 url</li>
            <li class="success">It decodes key from base 64 url</li>
            <li class="success">It performs encode decode roundtrip</li>
            <li class="success">It throws exception for invalid encoded key format</li>
            <li class="success">It throws exception for invalid decoded key length</li>
            <li class="success">It encrypts plaintext successfully</li>
            <li class="success">It decrypts ciphertext successfully</li>
            <li class="success">It performs encrypt decrypt roundtrip</li>
            <li class="success">It produces different ciphertexts for same plaintext</li>
            <li class="success">It throws exception for invalid key length on encrypt</li>
            <li class="success">It throws exception for invalid key length on decrypt</li>
            <li class="success">It throws exception for invalid ciphertext encoding</li>
            <li class="success">It throws exception for too short ciphertext</li>
            <li class="success">It throws exception for wrong decryption key</li>
            <li class="success">It throws exception for tampered ciphertext</li>
            <li class="success">It encrypts and decrypts with associated data</li>
            <li class="success">It fails decryption with wrong associated data</li>
            <li class="success">It fails decryption with missing associated data</li>
            <li class="success">It encrypts without associated data by default</li>
            <li class="success">It derives key from passphrase without salt</li>
            <li class="success">It derives key from passphrase with salt</li>
            <li class="success">It derives same key for same passphrase and salt</li>
            <li class="success">It derives different keys for different passphrases</li>
            <li class="success">It derives different keys for different salts</li>
            <li class="success">It throws exception for too short salt</li>
            <li class="success">It uses derived key for encryption</li>
            <li class="success">It handles empty plaintext</li>
            <li class="success">It handles large plaintext</li>
            <li class="success">It handles unicode characters</li>
            <li class="success">It handles binary data</li>
            <li class="success">It produces url safe ciphertext</li>
            <li class="success">It includes version in envelope</li>
            <li class="success">It rejects unsupported version</li>
            <li class="success">It provides authenticated encryption</li>
            <li class="success">It uses different nonces for each encryption</li>
            <li class="success">It maintains confidentiality</li>
        </ul>
        <h2>Translation Util (Tests\Unit\TranslationUtil)</h2>
        <ul>
            <li class="success">It initializes with default language</li>
            <li class="success">It initializes with provided language</li>
            <li class="success">It initializes with language from cookie</li>
            <li class="success">It prioritizes parameter over cookie</li>
            <li class="success">It prioritizes cookie over browser language</li>
            <li class="success">It sets language successfully</li>
            <li class="success">It loads translation file when setting language</li>
            <li class="success">It does not change language for nonexistent file</li>
            <li class="success">It changes language and loads new translations</li>
            <li class="success">It translates existing key</li>
            <li class="success">It returns key for missing translation</li>
            <li class="success">It translates multiple keys</li>
            <li class="success">It handles empty key</li>
            <li class="success">It detects english from browser</li>
            <li class="success">It detects german from browser</li>
            <li class="success">It falls back to english for unsupported language</li>
            <li class="success">It handles missing accept language header</li>
            <li class="success">It handles malformed accept language header</li>
            <li class="success">It only accepts supported languages</li>
            <li class="success">It ignores unsupported language codes</li>
            <li class="success">It preserves translations across multiple calls</li>
            <li class="success">It handles translation with special characters</li>
            <li class="success">It maintains state after multiple initializations</li>
            <li class="success">It returns consistent language code</li>
            <li class="success">It switches language successfully</li>
            <li class="success">It switches language multiple times</li>
            <li class="success">It clears previous translations on language switch</li>
            <li class="success">It respects cookie language preference</li>
            <li class="success">It ignores invalid cookie language</li>
            <li class="success">It provides full translation workflow</li>
            <li class="success">It handles missing translation gracefully</li>
            <li class="success">It loads translations into memory</li>
            <li class="success">It supports hierarchical translation keys</li>
        </ul>
        <h2>User (Tests\Unit\User)</h2>
        <ul>
            <li class="success">It creates user successfully</li>
            <li class="success">It creates user with multiple roles</li>
            <li class="success">It returns null when user creation fails</li>
            <li class="success">It creates user with ldap enabled</li>
            <li class="success">It finds user by id</li>
            <li class="success">It returns false when user not found by id</li>
            <li class="success">It handles invalid user ids with data set "zero"</li>
            <li class="success">It handles invalid user ids with data set "negative"</li>
            <li class="success">It handles invalid user ids with data set "non_existent"</li>
            <li class="success">It sets new password successfully</li>
            <li class="success">It returns false when user not found for password reset</li>
            <li class="success">It clears reset token when setting new password</li>
            <li class="success">It deletes user successfully</li>
            <li class="success">It returns false when deleting non existent user</li>
            <li class="success">It gets active session id</li>
            <li class="success">It returns null when user has no active session</li>
            <li class="success">It sets active session id</li>
            <li class="success">It gets last known ip</li>
            <li class="success">It returns null when user has no last known ip</li>
            <li class="success">It updates last known ip</li>
            <li class="success">It returns false when updating ip for non existent user</li>
            <li class="success">It handles different ip formats with data set "ipv4"</li>
            <li class="success">It handles different ip formats with data set "ipv6"</li>
            <li class="success">It handles different ip formats with data set "localhost_ipv4"</li>
            <li class="success">It handles different ip formats with data set "localhost_ipv6"</li>
        </ul>
    </body>
</html>